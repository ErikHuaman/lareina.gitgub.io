import{b as ie}from"./chunk-RMIZNUSK.js";import{c as te}from"./chunk-Q6VH5WW2.js";import{a as B,b as K,c as h}from"./chunk-UAFGHC4C.js";import{b as k,c as _,d as P,e as D,f as z,h as G,i as L,j,k as O,l as $,m as q,q as H,r as J,s as Q,t as W,v as X,w as Y,z as Z}from"./chunk-24HPCN5L.js";import{r as ee}from"./chunk-O33IRWRP.js";import"./chunk-FUIGKI6E.js";import{h as U,i as R}from"./chunk-NNFVYG4L.js";import{a as V}from"./chunk-JR3QTHJT.js";import{$a as C,Fc as M,G as c,Na as p,Pa as s,Q as f,V as E,Va as i,Wa as t,Xa as u,ab as v,bb as T,ca as S,da as y,e as w,fc as A,jb as r,jc as N,kb as g,rb as F,sb as x,wa as o}from"./chunk-3MNDLVIB.js";import{d as I}from"./chunk-ZXNH2FSH.js";var re=()=>[10,25,50];function le(l,a){l&1&&(i(0,"tr")(1,"th",26),r(2,"#"),t(),i(3,"th",27),r(4,"Nombre"),t(),i(5,"th",27),r(6,"Usuario"),t(),i(7,"th",27),r(8,"Rol"),t(),i(9,"th",28),r(10,"Acciones"),t()())}function ne(l,a){if(l&1){let d=C();i(0,"tr")(1,"td",27),r(2),t(),i(3,"td",27),r(4),t(),i(5,"td",27),r(6),t(),i(7,"td",27),r(8),t(),i(9,"td")(10,"div",29)(11,"p-button",30),v("click",function(){let m=S(d).$implicit,e=T();return y(e.editItem(m))}),t(),u(12,"p-button",31),t()()()}if(l&2){let d=a.$implicit,n=a.rowIndex;o(2),g(n+1),o(2),g(d.name),o(2),g(d.username),o(2),g(d.role==null?null:d.role.name),o(3),s("rounded",!0),o(),s("rounded",!0)}}function oe(l,a){l&1&&(i(0,"small",32),r(1,"El campo es obligatorio. "),t())}function ae(l,a){l&1&&(i(0,"small",33),r(1,"El campo es obligatorio. "),t())}function se(l,a){l&1&&(i(0,"small",34),r(1,"El campo es obligatorio. "),t())}function me(l,a){l&1&&(i(0,"small",35),r(1,"El campo es obligatorio. "),t())}var ke=(()=>{let a=class a{ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}constructor(){this.fb=f(O),this.dataService=f(V),this.dialogService=f(te),this.msg=f(ee),this.data=[],this.form=new z({}),this.roles=[],this._unsubscribeAll=new w}ngOnInit(){this.initForm(),this.getAll(),this.getRoles()}initForm(){this.form=this.fb.group({id:[null],name:[null,_.required],username:[null,_.required],password:[null],roleId:[null,_.required]})}get name(){return this.form.get("name")}get username(){return this.form.get("username")}get password(){return this.form.get("password")}get roleId(){return this.form.get("roleId")}getAll(){this.dataService.findAll(h.users).pipe(c(this._unsubscribeAll)).subscribe({next:n=>{this.data=n}})}getRoles(){this.dataService.findAll(h.roles).pipe(c(this._unsubscribeAll)).subscribe({next:n=>{this.roles=n}})}get isEdit(){return!!this.form?.get("id")?.value}get formLabel(){return`${this.isEdit?"Modificar":"Nuevo"} Usuario`}get buttonLabel(){return`${this.isEdit?"Actualizar":"Guardar"}`}clear(){this.initForm()}editItem(n){this.form.get("id")?.setValue(n.id),this.form.get("username")?.setValue(n.username),this.form.get("password")?.setValue(n.password),this.form.get("roleId")?.setValue(n.roleId)}save(){if(this.form.invalid){this.msg.info("Es necesario llenar el formulario.");return}if(this.isEdit){let m=this.form.value;this.dataService.update(h.users,m).pipe(c(this._unsubscribeAll)).subscribe({next:e=>{this.msg.success("Actualizado con \xE9xito."),this.getAll(),this.clear()},error:e=>{this.msg.error(e.error.messagge||"Ups! No se pudo actualizar.")}})}else{let n=this.form.value,{id:m}=n,e=I(n,["id"]);this.dataService.create(h.users,e).pipe(c(this._unsubscribeAll)).subscribe({next:b=>{this.msg.success("Registrado con \xE9xito."),this.getAll(),this.clear()},error:b=>{this.msg.error(b.error.messagge||"Ups! No se pudo registrar.")}})}}};a.\u0275fac=function(m){return new(m||a)},a.\u0275cmp=E({type:a,selectors:[["app-users"]],standalone:!0,features:[F],decls:38,vars:16,consts:[[1,"grid","row-gap-2"],[1,"col-12","lg:col-6"],["legend","Listado"],["styleClass","p-datatable-sm p-datatable-gridlines",3,"value","paginator","rows","showCurrentPageReport","currentPageReportTemplate","rowsPerPageOptions"],["pTemplate","header"],["pTemplate","body"],[3,"legend"],["pFocusTrap","",3,"formGroup"],[1,"col-6"],[1,"flex","flex-column","gap-2"],["htmlFor","name"],["id","name","type","text","pInputText","","pKeyFilter","alphanum","formControlName","name"],["id","name-help","class","p-error",4,"ngIf"],["htmlFor","username"],["id","username","type","text","pInputText","","pKeyFilter","alphanum","formControlName","username"],["id","username-help","class","p-error",4,"ngIf"],["htmlFor","roleId"],["optionLabel","name","optionValue","id","styleClass","w-full","formControlName","roleId","placeholder","Seleccionar...",3,"options"],["id","roleId-help","class","p-error",4,"ngIf"],["htmlFor","password"],["id","password","type","text","pInputText","","formControlName","password"],["id","password-help","class","p-error",4,"ngIf"],[1,"col-12"],[1,"flex","justify-content-end","gap-2"],["label","Limpiar","size","small","severity","danger",3,"click"],["size","small","severity","success",3,"click","label","disabled"],[1,"text-center",2,"width","4rem"],[1,"text-center"],[1,"text-center",2,"width","8rem"],[1,"flex","gap-2","justify-content-center"],["size","small","icon","bi bi-pen-fill","severity","success",3,"click","rounded"],["size","small","icon","bi bi-trash-fill","severity","danger",3,"rounded"],["id","name-help",1,"p-error"],["id","username-help",1,"p-error"],["id","roleId-help",1,"p-error"],["id","password-help",1,"p-error"]],template:function(m,e){m&1&&(i(0,"div",0)(1,"div",1)(2,"p-fieldset",2)(3,"p-table",3),p(4,le,11,0,"ng-template",4)(5,ne,13,6,"ng-template",5),t()()(),i(6,"div",1)(7,"p-fieldset",6)(8,"form",7)(9,"div",0)(10,"div",8)(11,"div",9)(12,"label",10),r(13,"Nombre"),t(),u(14,"input",11),p(15,oe,2,0,"small",12),t()(),i(16,"div",8)(17,"div",9)(18,"label",13),r(19,"Usuario"),t(),u(20,"input",14),p(21,ae,2,0,"small",15),t()(),i(22,"div",8)(23,"div",9)(24,"label",16),r(25,"Rol"),t(),u(26,"p-dropdown",17),p(27,se,2,0,"small",18),t()(),i(28,"div",8)(29,"div",9)(30,"label",19),r(31,"Contrase\xF1a"),t(),u(32,"input",20),p(33,me,2,0,"small",21),t()(),i(34,"div",22)(35,"div",23)(36,"p-button",24),v("click",function(){return e.clear()}),t(),i(37,"p-button",25),v("click",function(){return e.save()}),t()()()()()()()()),m&2&&(o(3),s("value",e.data)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("currentPageReportTemplate",e.data.length?"Mostrando del {first} al {last} de {totalRecords} registros":"{totalRecords} registros encontrados")("rowsPerPageOptions",x(15,re)),o(4),s("legend",e.formLabel),o(),s("formGroup",e.form),o(7),s("ngIf",(e.name==null?null:e.name.invalid)&&((e.name==null?null:e.name.dirty)||(e.name==null?null:e.name.touched))),o(6),s("ngIf",(e.username==null?null:e.username.invalid)&&((e.username==null?null:e.username.dirty)||(e.username==null?null:e.username.touched))),o(5),s("options",e.roles),o(),s("ngIf",(e.roleId==null?null:e.roleId.invalid)&&((e.roleId==null?null:e.roleId.dirty)||(e.roleId==null?null:e.roleId.touched))),o(6),s("ngIf",(e.password==null?null:e.password.invalid)&&((e.password==null?null:e.password.dirty)||(e.password==null?null:e.password.touched))),o(4),s("label",e.buttonLabel)("disabled",e.form.invalid))},dependencies:[N,A,$,G,k,P,D,q,L,j,K,B,M,Z,Y,J,H,ie,R,U,W,Q,X]});let l=a;return l})();export{ke as default};
