import{a as de}from"./chunk-6BUBAIQE.js";import{a as Q,b as W,c as f}from"./chunk-UAFGHC4C.js";import{c as _,d as B,e as j,f as H,h as O,i as $,j as q,k as U,l as J,m as K,o as X,p as Y,q as Z,r as ee,t as te,u as ie,v as re,w as oe,x as le,y as ne,z as ae}from"./chunk-24HPCN5L.js";import{r as se}from"./chunk-O33IRWRP.js";import"./chunk-FUIGKI6E.js";import{h as L,i as z}from"./chunk-NNFVYG4L.js";import{a as G}from"./chunk-JR3QTHJT.js";import{$a as C,Bb as S,Cb as T,Db as A,Fc as V,G as m,Na as c,Pa as s,Q as h,V as I,Va as i,Wa as t,Xa as u,ab as b,bb as F,ca as D,da as w,e as E,fc as M,ic as N,jb as o,jc as k,kb as v,lb as P,rb as R,sb as x,wa as l}from"./chunk-3MNDLVIB.js";import{d as y}from"./chunk-ZXNH2FSH.js";var pe=()=>[15,25,50];function me(n,a){n&1&&(i(0,"tr")(1,"th",25),o(2,"#"),t(),i(3,"th",26),o(4,"Producto"),t(),i(5,"th",26),o(6,"Fecha"),t(),i(7,"th",26),o(8,"Precio"),t(),i(9,"th",27),o(10,"Acciones"),t()())}function ce(n,a){if(n&1){let p=C();i(0,"tr",28)(1,"td",29),o(2),t(),i(3,"td",30),o(4),t(),i(5,"td",29),o(6),S(7,"date"),t(),i(8,"td",31),o(9),S(10,"soles"),t(),i(11,"td")(12,"div",32)(13,"p-button",33),b("click",function(){let d=D(p).$implicit,e=F();return w(e.editItem(d))}),t(),u(14,"p-button",34),t()()()}if(n&2){let p=a.$implicit,r=a.rowIndex;s("pReorderableRow",r),l(2),v(r+1),l(2),v(p.product==null?null:p.product.name),l(2),P(" ",A(7,7,p.startDate,"dd/MM/yy")," "),l(3),v(T(10,10,p.price)),l(4),s("rounded",!0),l(),s("rounded",!0)}}function ue(n,a){n&1&&(i(0,"small",35),o(1,"El campo es obligatorio. "),t())}function fe(n,a){n&1&&(i(0,"small",36),o(1,"El campo es obligatorio. "),t())}function ge(n,a){n&1&&(i(0,"small",37),o(1,"El campo es obligatorio. "),t())}var He=(()=>{let a=class a{ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}constructor(){this.fb=h(U),this.dataService=h(G),this.msg=h(se),this.data=[],this.products=[],this.form=new H({}),this._unsubscribeAll=new E}ngOnInit(){this.initForm(),this.getAll(),this.getProducts()}getProducts(){this.dataService.findAll(f.products).pipe(m(this._unsubscribeAll)).subscribe({next:r=>{this.products=r}})}initForm(){this.form=this.fb.group({id:[null],productId:[null,_.required],startDate:[null,_.required],price:[null,_.required]})}get productId(){return this.form.get("productId")}get startDate(){return this.form.get("startDate")}get price(){return this.form.get("price")}getAll(){this.dataService.findAll(f.prices).pipe(m(this._unsubscribeAll)).subscribe({next:r=>{this.data=r}})}get isEdit(){return!!this.form?.get("id")?.value}get formLabel(){return`${this.isEdit?"Modificar":"Nuevo"} Precio`}get buttonLabel(){return`${this.isEdit?"Actualizar":"Guardar"}`}clear(){this.initForm()}editItem(r){this.form.get("id")?.setValue(r.id),this.form.get("productId")?.setValue(r.productId),this.form.get("startDate")?.setValue(new Date(r.startDate)),this.form.get("price")?.setValue(r.price)}save(){if(this.form.invalid){this.msg.info("Es necesario llenar el formulario.");return}if(this.isEdit){let d=this.form.value;d.price=Number(d.price),this.dataService.update(f.prices,d).pipe(m(this._unsubscribeAll)).subscribe({next:e=>{this.msg.success("Actualizado con \xE9xito."),this.getAll(),this.clear()},error:e=>{this.msg.error(e.error.messagge||"Ups! No se pudo actualizar.")}})}else{let r=this.form.value,{id:d}=r,e=y(r,["id"]);e.price=Number(e.price),this.dataService.create(f.prices,e).pipe(m(this._unsubscribeAll)).subscribe({next:g=>{this.msg.success("Registrado con \xE9xito."),this.getAll(),this.clear()},error:g=>{this.msg.error(g.error.messagge||"Ups! No se pudo registrar.")}})}}};a.\u0275fac=function(d){return new(d||a)},a.\u0275cmp=I({type:a,selectors:[["app-prices"]],standalone:!0,features:[R],decls:35,vars:18,consts:[[1,"grid","row-gap-2"],[1,"col-12","lg:col-6"],["legend","Listado"],["styleClass","p-datatable-sm p-datatable-gridlines","responsiveLayout","scroll",3,"value","paginator","rows","showCurrentPageReport","currentPageReportTemplate","rowsPerPageOptions","reorderableColumns"],["pTemplate","header"],["pTemplate","body"],[3,"legend"],["pFocusTrap","",3,"formGroup"],[1,"col-12"],[1,"flex","flex-column","gap-2"],["htmlFor","productId"],["optionLabel","name","optionValue","id","styleClass","w-full","formControlName","productId","placeholder","Seleccionar...",3,"options"],["id","productId-help","class","p-error",4,"ngIf"],[1,"col-6"],["htmlFor","startDate"],["id","startDate","styleClass","w-full","dateFormat","dd/mm/yy","formControlName","startDate","placeholder","Seleccionar..."],["id","startDate-help","class","p-error",4,"ngIf"],["htmlFor","price"],[1,"p-inputgroup"],[1,"p-inputgroup-addon"],["inputId","price","formControlName","price","mode","decimal",3,"minFractionDigits","maxFractionDigits"],["id","price-help","class","p-error",4,"ngIf"],[1,"flex","justify-content-end","gap-2"],["label","Limpiar","size","small","severity","danger",3,"click"],["size","small","severity","success",3,"click","label","disabled"],[1,"text-center",2,"width","4rem"],[1,"text-center"],[1,"text-center",2,"width","8rem"],[3,"pReorderableRow"],["pReorderableRowHandle","",1,"text-center"],["pReorderableRowHandle",""],["pReorderableRowHandle","",1,"text-right"],[1,"flex","gap-2","justify-content-center"],["size","small","icon","bi bi-pen-fill","severity","success",3,"click","rounded"],["size","small","icon","bi bi-trash-fill","severity","danger",3,"rounded"],["id","productId-help",1,"p-error"],["id","startDate-help",1,"p-error"],["id","price-help",1,"p-error"]],template:function(d,e){d&1&&(i(0,"div",0)(1,"div",1)(2,"p-fieldset",2)(3,"p-table",3),c(4,me,11,0,"ng-template",4)(5,ce,15,12,"ng-template",5),t()()(),i(6,"div",1)(7,"p-fieldset",6)(8,"form",7)(9,"div",0)(10,"div",8)(11,"div",9)(12,"label",10),o(13,"Producto"),t(),u(14,"p-dropdown",11),c(15,ue,2,0,"small",12),t()(),i(16,"div",13)(17,"div",9)(18,"label",14),o(19,"Fecha de Aplicaci\xF3n"),t(),u(20,"p-calendar",15),c(21,fe,2,0,"small",16),t()(),i(22,"div",13)(23,"div",9)(24,"label",17),o(25,"Precio"),t(),i(26,"div",18)(27,"span",19),o(28,"S/"),t(),u(29,"p-inputNumber",20),t(),c(30,ge,2,0,"small",21),t()(),i(31,"div",8)(32,"div",22)(33,"p-button",23),b("click",function(){return e.clear()}),t(),i(34,"p-button",24),b("click",function(){return e.save()}),t()()()()()()()()),d&2&&(l(3),s("value",e.data)("paginator",!0)("rows",15)("showCurrentPageReport",!0)("currentPageReportTemplate",e.data.length?"Mostrando del {first} al {last} de {totalRecords} registros":"{totalRecords} registros encontrados")("rowsPerPageOptions",x(17,pe))("reorderableColumns",!0),l(4),s("legend",e.formLabel),l(),s("formGroup",e.form),l(6),s("options",e.products),l(),s("ngIf",(e.productId==null?null:e.productId.invalid)&&((e.productId==null?null:e.productId.dirty)||(e.productId==null?null:e.productId.touched))),l(6),s("ngIf",(e.startDate==null?null:e.startDate.invalid)&&((e.startDate==null?null:e.startDate.dirty)||(e.startDate==null?null:e.startDate.touched))),l(8),s("minFractionDigits",2)("maxFractionDigits",2),l(),s("ngIf",(e.price==null?null:e.price.invalid)&&((e.price==null?null:e.price.dirty)||(e.price==null?null:e.price.touched))),l(4),s("label",e.buttonLabel)("disabled",e.form.invalid))},dependencies:[k,M,N,de,J,O,B,j,K,$,q,W,Q,V,ae,oe,le,ne,ee,Z,Y,X,L,z,te,re,ie]});let n=a;return n})();export{He as default};
