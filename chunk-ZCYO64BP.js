import{a as U,b as H,c}from"./chunk-UAFGHC4C.js";import{b as D,c as h,d as L,e as R,f as z,h as G,i as $,j,k as O,l as q,m as B,q as J,r as K,s as Q,t as W,v as X,w as Y,z as Z}from"./chunk-24HPCN5L.js";import{r as ee}from"./chunk-O33IRWRP.js";import"./chunk-FUIGKI6E.js";import{h as V,i as x}from"./chunk-NNFVYG4L.js";import{a as k}from"./chunk-JR3QTHJT.js";import{$a as P,Fc as N,G as u,Na as f,Pa as s,Q as g,V as S,Va as i,Wa as t,Xa as b,ab as p,bb as w,ca as y,da as E,e as C,fc as A,jb as m,jc as M,kb as _,rb as T,sb as F,wa as l}from"./chunk-3MNDLVIB.js";import{d as I}from"./chunk-ZXNH2FSH.js";var te=()=>[15,25,50];function re(o,n){o&1&&(i(0,"tr")(1,"th",23),m(2,"#"),t(),i(3,"th",24),m(4,"Producto"),t(),i(5,"th",25),m(6,"Acciones"),t()())}function ie(o,n){if(o&1){let v=P();i(0,"tr")(1,"td",24),m(2),t(),i(3,"td"),m(4),t(),i(5,"td")(6,"div",26)(7,"p-button",27),p("click",function(){let a=y(v).$implicit,e=w();return E(e.editItem(a))}),t(),b(8,"p-button",28),t()()()}if(o&2){let v=n.$implicit,r=n.rowIndex;l(2),_(r+1),l(2),_(v.name),l(3),s("rounded",!0),l(),s("rounded",!0)}}function oe(o,n){o&1&&(i(0,"small",29),m(1,"El campo es obligatorio. "),t())}function le(o,n){o&1&&(i(0,"small",30),m(1,"El campo es obligatorio. "),t())}function ne(o,n){o&1&&(i(0,"small",31),m(1,"El campo es obligatorio. "),t())}var Me=(()=>{let n=class n{ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}constructor(){this.fb=g(O),this.dataService=g(k),this.msg=g(ee),this.data=[],this.measures=[],this.flavors=[],this.form=new z({}),this._unsubscribeAll=new C}ngOnInit(){this.initForm(),this.getAll(),this.getMeasures(),this.getFlavors()}getMeasures(){this.dataService.findAll(c.measures).pipe(u(this._unsubscribeAll)).subscribe({next:r=>{this.measures=r}})}getFlavors(){this.dataService.findAll(c.flavors).pipe(u(this._unsubscribeAll)).subscribe({next:r=>{this.flavors=r}})}initForm(){this.form=this.fb.group({id:[null],name:[null,h.required],measureId:[null,h.required],flavorId:[null,h.required]})}get name(){return this.form.get("name")}get measureId(){return this.form.get("measureId")}get flavorId(){return this.form.get("flavorId")}getAll(){this.dataService.findAll(c.products).pipe(u(this._unsubscribeAll)).subscribe({next:r=>{this.data=r.sort((a,e)=>a.order-e.order)}})}get isEdit(){return!!this.form?.get("id")?.value}get formLabel(){return`${this.isEdit?"Modificar":"Nuevo"} Precio`}get buttonLabel(){return`${this.isEdit?"Actualizar":"Guardar"}`}clear(){this.initForm()}editItem(r){this.form.get("id")?.setValue(r.id),this.form.get("name")?.setValue(r.name),this.form.get("measureId")?.setValue(r.measureId),this.form.get("flavorId")?.setValue(r.flavorId)}getProductName(){let r=this.measures.find(e=>e.id===this.form.get("measureId")?.value)?.name??"",a=this.flavors.find(e=>e.id===this.form.get("flavorId")?.value)?.name??"";this.form.get("name")?.setValue(`${r} de ${a}`)}save(){if(this.form.invalid){this.msg.info("Es necesario llenar el formulario.");return}if(this.isEdit){let a=this.form.value;this.dataService.update(c.products,a).pipe(u(this._unsubscribeAll)).subscribe({next:e=>{this.msg.success("Actualizado con \xE9xito."),this.getAll(),this.clear()},error:e=>{this.msg.error(e.error.messagge||"Ups! No se pudo actualizar.")}})}else{let r=this.form.value,{id:a}=r,e=I(r,["id"]);this.dataService.create(c.products,e).pipe(u(this._unsubscribeAll)).subscribe({next:d=>{this.msg.success("Registrado con \xE9xito."),this.getAll(),this.clear()},error:d=>{this.msg.error(d.error.messagge||"Ups! No se pudo registrar.")}})}}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=S({type:n,selectors:[["app-products"]],standalone:!0,features:[T],decls:32,vars:16,consts:[[1,"grid","row-gap-2"],[1,"col-12","lg:col-6"],["legend","Listado"],["styleClass","p-datatable-sm p-datatable-gridlines",3,"value","paginator","rows","showCurrentPageReport","currentPageReportTemplate","rowsPerPageOptions"],["pTemplate","header"],["pTemplate","body"],[3,"legend"],["pFocusTrap","",3,"formGroup"],[1,"col-6"],[1,"flex","flex-column","gap-2"],["htmlFor","measureId"],["optionLabel","name","optionValue","id","styleClass","w-full","formControlName","measureId","placeholder","Seleccionar...",3,"onChange","options"],["id","measureId-help","class","p-error",4,"ngIf"],["htmlFor","flavorId"],["optionLabel","name","optionValue","id","styleClass","w-full","formControlName","flavorId","placeholder","Seleccionar...",3,"onChange","options"],["id","flavorId-help","class","p-error",4,"ngIf"],[1,"col-12"],["htmlFor","name"],["id","name","type","text","pInputText","","formControlName","name","readonly",""],["id","name-help","class","p-error",4,"ngIf"],[1,"flex","justify-content-end","gap-2"],["label","Limpiar","size","small","severity","danger",3,"click"],["size","small","severity","success",3,"click","label","disabled"],[1,"text-center",2,"width","4rem"],[1,"text-center"],[1,"text-center",2,"width","8rem"],[1,"flex","gap-2","justify-content-center"],["size","small","icon","bi bi-pen-fill","severity","success",3,"click","rounded"],["size","small","icon","bi bi-trash-fill","severity","danger",3,"rounded"],["id","measureId-help",1,"p-error"],["id","flavorId-help",1,"p-error"],["id","name-help",1,"p-error"]],template:function(a,e){a&1&&(i(0,"div",0)(1,"div",1)(2,"p-fieldset",2)(3,"p-table",3),f(4,re,7,0,"ng-template",4)(5,ie,9,4,"ng-template",5),t()()(),i(6,"div",1)(7,"p-fieldset",6)(8,"form",7)(9,"div",0)(10,"div",8)(11,"div",9)(12,"label",10),m(13,"Medida"),t(),i(14,"p-dropdown",11),p("onChange",function(){return e.getProductName()}),t(),f(15,oe,2,0,"small",12),t()(),i(16,"div",8)(17,"div",9)(18,"label",13),m(19,"Sabor"),t(),i(20,"p-dropdown",14),p("onChange",function(){return e.getProductName()}),t(),f(21,le,2,0,"small",15),t()(),i(22,"div",16)(23,"div",9)(24,"label",17),m(25,"Producto"),t(),b(26,"input",18),f(27,ne,2,0,"small",19),t()(),i(28,"div",16)(29,"div",20)(30,"p-button",21),p("click",function(){return e.clear()}),t(),i(31,"p-button",22),p("click",function(){return e.save()}),t()()()()()()()()),a&2&&(l(3),s("value",e.data)("paginator",!0)("rows",15)("showCurrentPageReport",!0)("currentPageReportTemplate",e.data.length?"Mostrando del {first} al {last} de {totalRecords} registros":"{totalRecords} registros encontrados")("rowsPerPageOptions",F(15,te)),l(4),s("legend",e.formLabel),l(),s("formGroup",e.form),l(6),s("options",e.measures),l(),s("ngIf",(e.measureId==null?null:e.measureId.invalid)&&((e.measureId==null?null:e.measureId.dirty)||(e.measureId==null?null:e.measureId.touched))),l(5),s("options",e.flavors),l(),s("ngIf",(e.flavorId==null?null:e.flavorId.invalid)&&((e.flavorId==null?null:e.flavorId.dirty)||(e.flavorId==null?null:e.flavorId.touched))),l(6),s("ngIf",(e.name==null?null:e.name.invalid)&&((e.name==null?null:e.name.dirty)||(e.name==null?null:e.name.touched))),l(4),s("label",e.buttonLabel)("disabled",e.form.invalid))},dependencies:[M,A,q,G,D,L,R,B,$,j,H,U,N,Z,Y,K,J,x,V,W,Q,X]});let o=n;return o})();export{Me as default};
